import math

def вычислить(выражение):
    # Стек для чисел и операторов
    числа = []
    операторы = []

    # Текущее число
    текущее_число = ""

    # Приоритет операций
    приоритет = {'+': 1, '-': 1, '*': 2, '/': 2, '^': 3}

    # Функция для выполнения операции
    def выполнить_операцию():
        nonlocal текущее_число, числа
        if текущее_число != "":
            числа.append(float(текущее_число))
            текущее_число = ""

    # Функция для обработки операции
    def обработать_операцию():
        nonlocal числа, операторы
        if len(числа) > 1:
            число2 = числа.pop()
            число1 = числа.pop()
            оператор = операторы.pop()

            if оператор == '+':
                числа.append(число1 + число2)
            elif оператор == '-':
                числа.append(число1 - число2)
            elif оператор == '*':
                числа.append(число1 * число2)
            elif оператор == '/':
                if число2 == 0:
                    print("Ошибка: деление на ноль!")
                    return None
                числа.append(число1 / число2)
            elif оператор == '^':
                числа.append(число1 ** число2)
        return True

    # Проходим по всем символам выражения
    i = 0
    while i < len(выражение):
        символ = выражение[i]

        if символ.isdigit() or символ == '.':
            # Если символ цифра или точка (для чисел с плавающей точкой)
            текущее_число += символ
        elif символ in '+-*/^':
            # Если оператор, выполняем операции в зависимости от приоритета
            выполнить_операцию()

            while (операторы and операторы[-1] != '(' and
                   приоритет[операторы[-1]] >= приоритет[символ]):
                if not обработать_операцию():
                    return None

            операторы.append(символ)
        elif символ == '(':
            # Скобка открывающая
            операторы.append(символ)
        elif символ == ')':
            # Когда встречаем закрывающую скобку, выполняем операции до открывающей
            выполнить_операцию()
            while операторы and операторы[-1] != '(':
                if not обработать_операцию():
                    return None
            операторы.pop()  # Удаляем '(' из стека

        i += 1

    # После того, как прошли по всему выражению, выполняем оставшиеся операции
    выполнить_операцию()
    while операторы:
        if not обработать_операцию():
            return None

    return числа[0]

def калькулятор():
    while True:
        выражение = input("Введите математическое выражение или 'выход' для завершения: ").replace(' ', '')

        if выражение.lower() == 'выход':
            print("Выход из программы.")
            break

        результат = вычислить(выражение)

        if результат is not None:
            print(f"Результат: {результат}")

# Запуск калькулятора
калькулятор()